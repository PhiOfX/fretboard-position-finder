function multiple_notes(e,t){var o=window.location.href,r=new URL(o),i=r.searchParams.get("position_select");if(i){for(var a in scale_data[t])if(scale_data[t].hasOwnProperty(a))for(var s in scale_data[t][a][0].tones){var e=scale_data[t][a][0].tones[s];if(document.querySelectorAll("."+e+".active").length>2){var o=window.location.href,r=new URL(o),i=r.searchParams.get("position_select");if(0!=i){var n=[];for(var l in frets)for(var c in string_array){var v="."+frets[l]+"."+string_array[c]+" ."+e+".active",f=document.querySelectorAll(v);0!=f.length&&n.push(string_array[c])}if(n.length>1){var u=[],g=[],d=[];for(var h in n){var c=n[h];for(var m in frets){var v="."+c+"."+frets[m]+" .active",f=document.querySelectorAll(v);0!=f.length&&(h>0?g.push(m):u.push(m),d.push(c))}}if(u.length>0&&g.length>0){var y=u[u.length-1]-u[0],p=g[g.length-1]-g[0],$=d[0],S=d[d.length-1];y>p?deactivateActiveNotes($,e):deactivateActiveNotes(S,e)}}}}}}}function deactivateActiveNotes(e,t){document.querySelectorAll("."+e+" ."+t+".active").forEach(function(e){e.classList.remove("active")})}function avoid_four_notes_on_string(){var e=[string_array[0],string_array[string_array.length-1]];for(x in e){var t=document.querySelectorAll("."+e[x]+" .active > img");t.length>3&&(e[x]==e[1]?t[0].classList.remove("active"):t[3].classList.remove("active"))}}function getTonesFromDataScales(e){resetFretboard();var t=0;for(var o in scale_data[e])if(scale_data[e].hasOwnProperty(o))for(var r in scale_data[e][o][0].tones){var i=scale_data[e][o][0].tones[r],a=document.querySelector("."+o+" img.tone."+i);null!=a&&a.classList.add("active");var a=document.querySelector("."+o+" .note."+i);null!=a&&a.classList.add("active"),element=document.querySelectorAll("."+i+".active")}for(var o in multiple_notes(i,e),0!=document.getElementById("position_select").value&&avoid_four_notes_on_string(),scale_data.root)if(scale_data.root.hasOwnProperty(o)){var s=scale_data.root[o];for(t=0;t<string_array.length;t++){string=string_array[t];var n=document.querySelector("."+string+" img.tone.active."+s);null!=n&&(n.setAttribute("src","/static/media/red_dot_24.svg"),n.classList.add("active"),n.classList.add("root"))}}}function multiple_notes(e,t){var o=window.location.href,r=new URL(o),i=r.searchParams.get("position_select");if(i){for(var a in scale_data[t])if(scale_data[t].hasOwnProperty(a))for(var s in scale_data[t][a][0].tones){var e=scale_data[t][a][0].tones[s];if(document.querySelectorAll("."+e+".active").length>2){var o=window.location.href,r=new URL(o),i=r.searchParams.get("position_select");if(0!=i){var n=[];for(var l in frets)for(var c in string_array){var v="."+frets[l]+"."+string_array[c]+" ."+e+".active",f=document.querySelectorAll(v);0!=f.length&&n.push(string_array[c])}if(n.length>1){var u=[],g=[],d=[];for(var h in n){var c=n[h];for(var m in frets){var v="."+c+"."+frets[m]+" .active",f=document.querySelectorAll(v);0!=f.length&&(h>0?g.push(m):u.push(m),d.push(c))}}if(u.length>0&&g.length>0){var y=u[u.length-1]-u[0],p=g[g.length-1]-g[0],$=d[0],S=d[d.length-1];y>p?deactivateActiveNotes($,e):deactivateActiveNotes(S,e)}}}}}}}function deactivateActiveNotes(e,t){document.querySelectorAll("."+e+" ."+t+".active").forEach(function(e){e.classList.remove("active")})}function avoid_four_notes_on_string(){var e=[string_array[0],string_array[string_array.length-1]];for(x in e){var t=document.querySelectorAll("."+e[x]+" .active > img");t.length>3&&(e[x]==e[1]?t[0].classList.remove("active"):t[3].classList.remove("active"))}}function getTonesFromDataScales(e){resetFretboard();var t=0;for(var o in scale_data[e])if(scale_data[e].hasOwnProperty(o))for(var r in scale_data[e][o][0].tones){var i=scale_data[e][o][0].tones[r],a=document.querySelector("."+o+" img.tone."+i);null!=a&&a.classList.add("active");var a=document.querySelector("."+o+" .note."+i);null!=a&&a.classList.add("active"),element=document.querySelectorAll("."+i+".active")}for(var o in multiple_notes(i,e),0!=document.getElementById("position_select").value&&avoid_four_notes_on_string(),scale_data.root)if(scale_data.root.hasOwnProperty(o)){var s=scale_data.root[o];for(t=0;t<string_array.length;t++){string=string_array[t];var n=document.querySelector("."+string+" img.tone.active."+s);null!=n&&(n.setAttribute("src","/static/media/red_dot_24.svg"),n.classList.add("active"),n.classList.add("root"))}}}function updateCursorVisibility(e,t){var o=document.querySelector(".left-cursor"),r=document.querySelector(".right-cursor");e>0?o.style.display="block":o.style.display="none",e<t-1?r.style.display="block":r.style.display="none"}function leftCursorClick(){var e=window.location.href,t=parseInt(new URL(e).searchParams.get("position_select")),o=Object.keys(scale_data).filter(e=>!isNaN(e)).length;if(t>0){var r=t-1;document.getElementById("position_select").value=r,document.getElementById("fretboard_form").submit(),updateCursorVisibility(r,o)}}function rightCursorClick(){var e=window.location.href,t=new URL(e).searchParams.get("position_select");t=null===t||""===t?0:parseInt(t);var o=Object.keys(scale_data).filter(e=>!isNaN(e)).length;if(t<o-1){var r=t+1;document.getElementById("position_select").value=r,document.getElementById("fretboard_form").submit(),updateCursorVisibility(r,o)}}function customizeSelectField(e){for(var t=document.getElementsByClassName(e),o=0;o<t.length;o++){var r=t[o].getElementsByTagName("select")[0],i=document.createElement("DIV");i.setAttribute("class","sese"),i.innerHTML=r.options[r.selectedIndex].innerHTML,t[o].appendChild(i);var a=document.createElement("DIV");a.setAttribute("class","slit sehi");for(var s=1;s<r.length;s++){var n=document.createElement("DIV");n.innerHTML=r.options[s].innerHTML,n.addEventListener("click",function(e){var t,o,r,i;r=this.parentNode.parentNode.getElementsByTagName("select")[0],i=this.parentNode.previousSibling;for(var a=0;a<r.length;a++)if(r.options[a].innerHTML==this.innerHTML){for(o=0,r.selectedIndex=a,i.innerHTML=this.innerHTML,t=this.parentNode.getElementsByClassName("swasd");o<t.length;o++)t[o].removeAttribute("class");this.setAttribute("class","swasd");break}i.click(),document.getElementById("fretboard_form").submit()}),a.appendChild(n)}t[o].appendChild(a),i.addEventListener("click",function(e){e.stopPropagation(),closeAllSelect(this),this.nextSibling.classList.toggle("sehi"),this.classList.toggle("slar-active")})}}function closeAllSelect(e){for(var t=document.getElementsByClassName("slit"),o=document.getElementsByClassName("sese"),r=[],i=0;i<o.length;i++)e==o[i]?r.push(i):o[i].classList.remove("slar-active");for(var i=0;i<t.length;i++)r.indexOf(i)&&t[i].classList.add("sehi")}document.addEventListener("DOMContentLoaded",function(){var e=window.location.href,t=new URL(e).searchParams.get("position_select");updateCursorVisibility(t=null===t||""===t?0:parseInt(t),Object.keys(scale_data).filter(e=>!isNaN(e)).length)}),window.onload=function(){let e=document.getElementById("overlayMenu");e.style.display="none",customizeSelectField("sfbsfnos"),customizeSelectField("sfbsfpos"),customizeSelectField("sfbsf"),document.addEventListener("click",closeAllSelect);var t=document.getElementById("position_select").value,o=window.location.href;(t=new URL(o).searchParams.get("position_select"))?getTonesFromDataScales(t):getTonesFromDataScales("0")};const notes=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],validRoots=Array.from({length:17},(e,t)=>t+1).filter(e=>![2,5,9,12,15].includes(e));function changeScaleRoot(e){var t=new URLSearchParams(window.location.search),o=parseInt(t.get("root"))||1,r=validRoots[(validRoots.indexOf(o)+e+validRoots.length)%validRoots.length];if(t.set("root",r),window.history.replaceState(null,null,"?"+t.toString()),t.has("position_select")){var i=t.get("position_select");t.get("note_range")||document.getElementById("note_range")&&document.getElementById("note_range").value,getTonesFromDataScales(i)}window.location.search=t.toString()}function increaseRoot(){changeScaleRoot(1)}function decreaseRoot(){changeScaleRoot(-1)}